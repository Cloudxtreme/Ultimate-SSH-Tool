##DESCRP=Temporary fix the cpanel account quota doubling bug by Michael G
function cpquotafix(){
# cPanel 11.44.1 quota's doubling temp fix
# script v0.1b

# Affected Accounts quotas file list
AFFACC="$(find /home/*/.cpanel/datastore/ -type f -name '_usr_local_cpanel_bin_quota_*' -exec ls -lh '{}' ';'|awk '{print $9}')"

# Back them up to /root/support first
echo "Backing up quota files..."
mkdir /root/support/quotabu/
for eacha in $AFFACC; do cp -a $eacha /root/support/quotabu;done
echo "Backup complete"

# Sed to remove the /dev/simfs/ line
echo "Applying Band-Aid..."
for eachb in $AFFACC; do sed -i '/\/dev\/simfs/ s/^.*$//' $eachb;done

# Restart cPanel services
echo "Restarting cPanel services..."
/scripts/restartsrv cpanel &>/dev/null 
echo "Temporary quotas fix applied."
}
